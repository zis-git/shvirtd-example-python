# Домашнее задание к занятию 5. «Практическое применение Docker» Голоха Е.В.



## Задача 1
1. Сделайте в своем GitHub пространстве fork [репозитория](https://github.com/netology-code/shvirtd-example-python).

2. Создайте файл ```Dockerfile.python``` на основе существующего `Dockerfile`:
   - Используйте базовый образ ```python:3.12-slim```
   - Обязательно используйте конструкцию ```COPY . .``` в Dockerfile
   - Создайте `.dockerignore` файл для исключения ненужных файлов
   - Используйте ```CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "5000"]``` для запуска
   - Протестируйте корректность сборки 
3. (Необязательная часть, *) Изучите инструкцию в проекте и запустите web-приложение без использования docker, с помощью venv. (Mysql БД можно запустить в docker run).
4. (Необязательная часть, *) Изучите код приложения и добавьте управление названием таблицы через ENV переменную.
---
### ВНИМАНИЕ!
!!! В процессе последующего выполнения ДЗ НЕ изменяйте содержимое файлов в fork-репозитории! Ваша задача ДОБАВИТЬ 5 файлов: ```Dockerfile.python```, ```compose.yaml```, ```.gitignore```, ```.dockerignore```,```bash-скрипт```. Если вам понадобилось внести иные изменения в проект - вы что-то делаете неверно!
---
## Решение 1

https://github.com/zis-git/shvirtd-example-python


## Задача 2 (*)
1. Создайте в yandex cloud container registry с именем "test" с помощью "yc tool" . [Инструкция](https://cloud.yandex.ru/ru/docs/container-registry/quickstart/?from=int-console-help)
2. Настройте аутентификацию вашего локального docker в yandex container registry.
3. Соберите и залейте в него образ с python приложением из задания №1.
4. Просканируйте образ на уязвимости.
5. В качестве ответа приложите отчет сканирования.

## Решение 2
<img width="832" height="222" alt="2025-10-08_13-34-42" src="https://github.com/user-attachments/assets/e90bddbb-37b9-49be-a745-7b6de3923e72" />
<img width="2353" height="1167" alt="2025-10-08_13-41-11" src="https://github.com/user-attachments/assets/fd8588d3-dd8f-4004-b0a5-0b3bc068bf5d" />
<img width="649" height="141" alt="2025-10-08_13-42-09" src="https://github.com/user-attachments/assets/351709ba-53be-4ba4-82a5-5118befec403" />



## Задача 3
1. Изучите файл "proxy.yaml"
2. Создайте в репозитории с проектом файл ```compose.yaml```. С помощью директивы "include" подключите к нему файл "proxy.yaml".
3. Опишите в файле ```compose.yaml``` следующие сервисы: 

- ```web```. Образ приложения должен ИЛИ собираться при запуске compose из файла ```Dockerfile.python``` ИЛИ скачиваться из yandex cloud container registry(из задание №2 со *). Контейнер должен работать в bridge-сети с названием ```backend``` и иметь фиксированный ipv4-адрес ```172.20.0.5```. Сервис должен всегда перезапускаться в случае ошибок.
Передайте необходимые ENV-переменные для подключения к Mysql базе данных по сетевому имени сервиса ```web``` 

- ```db```. image=mysql:8. Контейнер должен работать в bridge-сети с названием ```backend``` и иметь фиксированный ipv4-адрес ```172.20.0.10```. Явно перезапуск сервиса в случае ошибок. Передайте необходимые ENV-переменные для создания: пароля root пользователя, создания базы данных, пользователя и пароля для web-приложения.Обязательно используйте уже существующий .env file для назначения секретных ENV-переменных!

2. Запустите проект локально с помощью docker compose , добейтесь его стабильной работы: команда ```curl -L http://127.0.0.1:8090``` должна возвращать в качестве ответа время и локальный IP-адрес. Если сервисы не стартуют воспользуйтесь командами: ```docker ps -a ``` и ```docker logs <container_name>``` . Если вместо IP-адреса вы получаете информационную ошибку --убедитесь, что вы шлете запрос на порт ```8090```, а не 5000.

5. Подключитесь к БД mysql с помощью команды ```docker exec -ti <имя_контейнера> mysql -uroot -p<пароль root-пользователя>```(обратите внимание что между ключем -u и логином root нет пробела. это важно!!! тоже самое с паролем) . Введите последовательно команды (не забываем в конце символ ; ): ```show databases; use <имя вашей базы данных(по-умолчанию example)>; show tables; SELECT * from requests LIMIT 10;```.

6. Остановите проект. В качестве ответа приложите скриншот sql-запроса.

## Решение 3
<img width="1554" height="434" alt="2025-10-08_13-48-29" src="https://github.com/user-attachments/assets/51d25e1f-ad01-4e04-a9b6-6adef7ea712d" />


## Задача 4
1. Запустите в Yandex Cloud ВМ (вам хватит 2 Гб Ram).
2. Подключитесь к Вм по ssh и установите docker.
3. Напишите bash-скрипт, который скачает ваш fork-репозиторий в каталог /opt и запустит проект целиком.
4. Зайдите на сайт проверки http подключений, например(или аналогичный): ```https://check-host.net/check-http``` и запустите проверку вашего сервиса ```http://<внешний_IP-адрес_вашей_ВМ>:8090```. Таким образом трафик будет направлен в ingress-proxy. Трафик должен пройти через цепочки: Пользователь → Internet → Nginx → HAProxy → FastAPI(запись в БД) → HAProxy → Nginx → Internet → Пользователь
5. (Необязательная часть) Дополнительно настройте remote ssh context к вашему серверу. Отобразите список контекстов и результат удаленного выполнения ```docker ps -a```
6. Повторите SQL-запрос на сервере и приложите скриншот и ссылку на fork.

## Решение 4
<img width="1344" height="649" alt="2025-10-08_14-40-18" src="https://github.com/user-attachments/assets/c214d11c-34b5-4501-b930-0afb0279b57b" />


## Задача 5 (*)
1. Напишите и задеплойте на вашу облачную ВМ bash скрипт, который произведет резервное копирование БД mysql в директорию "/opt/backup" с помощью запуска в сети "backend" контейнера из образа ```schnitzler/mysqldump``` при помощи ```docker run ...``` команды. Подсказка: "документация образа."
2. Протестируйте ручной запуск
3. Настройте выполнение скрипта раз в 1 минуту через cron, crontab или systemctl timer. Придумайте способ не светить логин/пароль в git!!
4. Предоставьте скрипт, cron-task и скриншот с несколькими резервными копиями в "/opt/backup"


## Решение 5
<img width="885" height="409" alt="2025-10-08_15-14-52" src="https://github.com/user-attachments/assets/e058a4d3-1325-490f-941a-36500f84cfe7" />
<img width="689" height="630" alt="2025-10-08_15-17-53" src="https://github.com/user-attachments/assets/ac5ce951-4758-41a3-a1ef-a81d6c464554" />


## Задача 6
Скачайте docker образ ```hashicorp/terraform:latest``` и скопируйте бинарный файл ```/bin/terraform``` на свою локальную машину, используя dive и docker save.
Предоставьте скриншоты  действий .

<img width="809" height="423" alt="2025-10-08_15-30-43" src="https://github.com/user-attachments/assets/0918f1bf-bf96-4f78-bf31-d9c767edbed4" />


## Задача 6.1
Добейтесь аналогичного результата, используя docker cp.  
Предоставьте скриншоты  действий .
<img width="994" height="658" alt="2025-10-08_15-24-43" src="https://github.com/user-attachments/assets/04e59f5a-f589-4e2a-bb40-00c294211d60" />


## Задача 6.2 (**)
Предложите способ извлечь файл из контейнера, используя только команду docker build и любой Dockerfile.  
Предоставьте скриншоты  действий .
<img width="778" height="275" alt="2025-10-08_15-33-09" src="https://github.com/user-attachments/assets/5275d94c-708f-4de9-b5d4-2fec29a6d6af" />
<img width="1048" height="768" alt="2025-10-08_15-28-07" src="https://github.com/user-attachments/assets/b58cdc8d-6975-44ca-864e-a3b4b917741a" />

## Задача 7 (***)
Запустите ваше python-приложение с помощью runC, не используя docker или containerd.  
Предоставьте скриншоты  действий .
<img width="1822" height="488" alt="2025-10-08_15-44-20" src="https://github.com/user-attachments/assets/c2f22599-cd58-499f-8368-7faa20a2c3ab" />
<img width="1039" height="1059" alt="2025-10-08_15-56-18" src="https://github.com/user-attachments/assets/b7bfa683-575f-4152-b7bb-3710e689ef19" />

## Доработка 
<img width="2181" height="1126" alt="2025-10-09_08-07-01" src="https://github.com/user-attachments/assets/95362302-78d3-42ff-9d36-46c7b35d820a" />
<img width="837" height="148" alt="2025-10-09_08-15-42" src="https://github.com/user-attachments/assets/c309b552-a7bb-4137-918f-9c0f9b301cac" />




